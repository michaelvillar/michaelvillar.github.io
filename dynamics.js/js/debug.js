// Generated by CoffeeScript 1.4.0
(function() {
  var BrowserSupport, Overrides, UIGraph, UIPanel, UIProperty, UISlider, css, getName, onReady, roundf,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    _this = this;

  css = 'div#DynamicsInteractivePanel, div#DynamicsInteractivePanel * {\n  margin: 0;\n  padding: 0;\n  border: 0;\n  font-family: "HelveticaNeue", "Helvetica Neue", Helvetica, Arial;\n  color: #000;\n}\ndiv#DynamicsInteractivePanel {\n  position: absolute;\n  top: 10px;\n  left: 10px;\n  width: 584px;\n  height: 378px;\n  padding: 0 0 10px 0;\n  border-radius: 8px;\n  box-shadow: 0 4px 30px rgba(0, 0, 0, .15),\n              0 2px 10px rgba(0, 0, 0, .25);\n  background: white;\n  z-index: 10000000;\n}\ndiv#DynamicsInteractivePanel > div.closeButton {\n  position: absolute;\n  top: 5px;\n  left: 4px;\n  width: 19px;\n  height: 19px;\n  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAABLElEQVQ4Ea2UTU7DMBBGPzu9BCfgHL1AK7EBqVyjrYTEihXiGmQBEgtOwHG4BNT4TTttmtpJFkykyJ6f529s2RK2Sdd6SO/apqXNp/zIpYbabMEGjb7y6Eo7/eZvpZfwNsjapruc/6qoRknfuWYeNdOTQagk0KjVOt1WQV0ISQjIjJhprSnxyiFYH0LNvos26jl8Wjs43EowVHo7nudbkRnBfdYObQFx80TmtdhhP08gklm1VECstEDnUM5BNRh+N1fZgRC6BOEtKcNfgRCK/P7DLhXV1PhqFVXnoBKEQmzyZtcgXBmsdJqd67RXNATx0xnJCXbjgz7GpJuqGmynGzpfTYJAQh3t+L7hgzDTfdSPHu0pwFk5EUJH68N4RmCY+cO2SYtjwdig97D9AYL5tI8mNx25AAAAAElFTkSuQmCC) no-repeat;\n  background-size: 9px 9px;\n  background-position: center center;\n  z-index: 100\n}\ndiv#DynamicsInteractivePanel > div.resizeButton {\n  position: absolute;\n  bottom: -15px;\n  right: -15px;\n  width: 30px;\n  height: 30px;\n  background: transparent;\n  cursor: nwse-resize;\n  z-index: 100\n}\ndiv#DynamicsInteractivePanel > div.title {\n  position: absolute;\n  padding: 6px 0;\n  width: 100%;\n  color: #394E6E;\n  font-size: 13px;\n  text-align: center;\n  user-select: none;\n  -webkit-user-select: none;\n  cursor: default;\n  font-family: "HelveticaNeueMedium", "HelveticaNeue-Medium", "Helvetica Neue Medium", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial\n}\ndiv#DynamicsInteractivePanel > div.content {\n  position: absolute;\n  top: 28px;\n  left: 10px;\n  right: 10px;\n  height: calc(100% - 28px);\n}\ndiv#DynamicsInteractivePanel > div.content > div.graph {\n  position: relative;\n  height: 100%;\n  width: calc(100% - 214px);\n  overflow: hidden;\n  user-select: none;\n  -webkit-user-select: none;\n  cursor: default;\n}\ndiv#DynamicsInteractivePanel > div.content > div.graph > span {\n  font-size: 10px;\n  color: #8096B1;\n  position: absolute;\n  left: 2px;\n  margin-top: -5px;\n}\ndiv#DynamicsInteractivePanel > div.content > div.graph > span.index1 { top: calc(33% - 8px); }\ndiv#DynamicsInteractivePanel > div.content > div.graph > span.index0 { top: calc(66% - 11px); }\ndiv#DynamicsInteractivePanel > div.content > div.graph > canvas {\n  background: #F4F9FF;\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings {\n  position: absolute;\n  top: 10px;\n  right: 0;\n  width: 205px;\n  height: calc(100% - 20px);\n  overflow-y: auto;\n  -webkit-user-select: none;\n  -moz-select: none;\n  user-select: none;\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings select {\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n  border: none;\n  width: 100%;\n  height: 27px;\n  border-radius: 5px;\n  padding: 6px 20px 6px 6px;\n  color: #fff;\n  font-size: 13px;\n  margin-bottom: 15px;\n  text-align: left;\n  background: #007EFF url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAICAYAAAAx8TU7AAAAOUlEQVQIHWNgAIL///8bAPFpEA3igwR4gPgWEIMAiOYBCS4C8ZDAIrBq4gigNkztQEFMi6AuQHESAPMeXiEMiWfpAAAAAElFTkSuQmCC) no-repeat 190px 9px;\n  background-size: 5px 8px;\n}\n@media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min--moz-device-pixel-ratio: 1.5), only screen and (min-device-pixel-ratio: 1.5)\n{\n  div#DynamicsInteractivePanel > div.content > div.settings select {\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAQCAYAAAAvf+5AAAAAeklEQVQoFc2SwQ2AIAxFGYALo7CY7OQGMo6beMJXQ5PWYOAoyael/5FAIQQzWmsJHV3JWD4FqEhH9W5f4RYlTCwOxsjoMoCmUssPTBLRqc4gihcD0z4w36XdHeGvi+XLAK61R24KPG+4tgR49ISb+i4Czz+F7AD8/GY3j4s9N2crn9sAAAAASUVORK5CYII=);\n  }\n  div#DynamicsInteractivePanel > div.closeButton {\n    background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAACDElEQVRYCc3YO1LDMBAG4JWZ1BwiDTUNR+AIUIQOuEFmwglghoIe0kFBjsARKOjTwB0omcwg9DtZKzaSrZU2AyriR6zdT7YkPwx1y9SekKEDWtEj3ZmP7t8q21M7djkmZGlJt2axHdP4DWtoRvdU0Xm975s+XaVjujav/hiFtSt75CAvLs/+Js+cbuiSyFhsb0AdDOfVRnUxPk+DWoNm9qE5M3wQL7VQMYzP41DmwhD6zIieeX9wWYoawnDSFZ1WdQfmHbElrjeuOwJLSyoGcd1gqlyiJ8IZGCo5KAkGBjeyKzfs3uvRpI2SYjCi3TTjh31OgNiUUBDLg3DJCgI1V7wwRhtUiirEIP1vUC4K9bZnYGzHSs80EgYhkLS1qMO3A6zHSg8GVeIg/CtB4fihMoBB9X4QjtBCJWDSQBqoREw6qAQlwMhAOSghBikq/PynMtypWZvbuYVnKQ2Ui+HGCFDDoFKMENUP0sIIUHGQBINLgrKzW4cUg4crlJ3cXHMw/KBWUrduUfdephBQdO8LjD7fhzQwm1aWoNYgTUwhCi+KY9qjN40RwpZmKW3oFx3iRXGyEwxU6OwYgTwtNNLACqaMEZ3hRXEZ+Lu9K9D52gf0bElQzoIXxYVrwTwasgTDQVNQMDjL+vED32dCKA1MCgq5629ErXmo841IE8MoLLsdvcG0Plht1fjjT3o/uTx2nIf8KNoAAAAASUVORK5CYII=\');\n  }\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings select:focus {\n  outline: none;\n  background-color: #394E6E;\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings label {\n  float: left;\n  color: #394E6E;\n  font-size: 13px;\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings .value {\n  float: right;\n  color: #394E6E;\n  font-size: 13px;\n  margin-bottom: 4px\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings div.slider {\n  clear: both;\n  position: relative;\n  width: 100%;\n  height: 20px;\n  margin-bottom: 7px;\n  user-select: none;\n  -webkit-user-select: none;\n  cursor: default;\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings div.slider .bar {\n  position: absolute;\n  top: 4px;\n  left: 0;\n  background: #e0effe;\n  height: 3px;\n  width: 100%;\n  border-radius: 3px;\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings div.slider .control {\n  position: absolute;\n  top: 0;\n  left: 0;\n  background: #fff;\n  height: 7px;\n  width: 7px;\n  border: 2px solid #007EFF;\n  border-radius: 6px;\n}\ndiv#DynamicsInteractivePanel > div.content > div.settings div.slider .control:active {\n  border-color: black;\n}';

  onReady = function(fn) {
    var loaded,
      _this = this;
    loaded = document.readyState === "complete" || document.readyState === "loaded" || document.readyState === "interactive";
    if (!loaded) {
      return document.addEventListener("DOMContentLoaded", function() {
        return fn();
      }, false);
    } else {
      return fn();
    }
  };

  roundf = function(float, decimals) {
    var factor;
    factor = Math.pow(10, decimals);
    return Math.round(float * factor) / factor;
  };

  getName = function(func) {
    return func.name || func.toString().match(/^function\s*([^\s(]+)/)[1];
  };

  BrowserSupport = (function() {

    function BrowserSupport() {}

    BrowserSupport.transform = function() {
      return this.withPrefix("transform");
    };

    BrowserSupport.keyframes = function() {
      if (document.body.style.webkitAnimation != null) {
        return "-webkit-keyframes";
      }
      if (document.body.style.mozAnimation != null) {
        return "-moz-keyframes";
      }
      return "keyframes";
    };

    BrowserSupport.withPrefix = function(property) {
      var prefix;
      prefix = this.prefixFor(property);
      if (prefix !== '') {
        return "-" + (prefix.toLowerCase()) + "-" + property;
      }
      return property;
    };

    BrowserSupport.prefixFor = function(property) {
      var k, prefix, prop, propArray, propertyName, _i, _j, _len, _len1, _ref;
      propArray = property.split('-');
      propertyName = "";
      for (_i = 0, _len = propArray.length; _i < _len; _i++) {
        prop = propArray[_i];
        propertyName += prop.substring(0, 1).toUpperCase() + prop.substring(1);
      }
      _ref = ["Webkit", "Moz"];
      for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
        prefix = _ref[_j];
        k = prefix + propertyName;
        if (document.body.style[k] != null) {
          return prefix;
        }
      }
      return '';
    };

    return BrowserSupport;

  })();

  UIGraph = (function() {

    function UIGraph(canvas) {
      this._drawCurve = __bind(this._drawCurve, this);

      this.insertPoint = __bind(this.insertPoint, this);

      this.canvasKeyUp = __bind(this.canvasKeyUp, this);

      this.canvasMouseUp = __bind(this.canvasMouseUp, this);

      this.canvasMouseMove = __bind(this.canvasMouseMove, this);

      this.canvasMouseDown = __bind(this.canvasMouseDown, this);

      this.pointFromLocation = __bind(this.pointFromLocation, this);

      this.isLocationAroundCenter = __bind(this.isLocationAroundCenter, this);

      this.locationFromEvent = __bind(this.locationFromEvent, this);

      this.draw = __bind(this.draw, this);

      var _this = this;
      this.points = null;
      this.dynamic = null;
      this.canvas = canvas;
      this.ctx = canvas.getContext('2d');
      this.r = window.devicePixelRatio || 1;
      if (this.r) {
        canvas.width = canvas.width * this.r;
        canvas.height = canvas.height * this.r;
        canvas.style[BrowserSupport.prefixFor('transform-origin') + 'TransformOrigin'] = "0 0";
        canvas.style[BrowserSupport.prefixFor('transform') + 'Transform'] = 'scale(' + (1 / this.r) + ')';
      }
      this.canvas.addEventListener('mousedown', this.canvasMouseDown);
      this.canvas.addEventListener('mousemove', this.canvasMouseMove);
      this.canvas.addEventListener('mouseup', this.canvasMouseUp);
      this.canvas.addEventListener('keyup', this.canvasKeyUp);
      this.canvas.addEventListener('keydown', function(e) {
        return e.preventDefault();
      });
    }

    UIGraph.prototype.draw = function() {
      var args, color, colorI, colors, controlPoint, coords, coordsControlPoint, defaultColor, graph, graphes, h, i, point, points, r, step, w, _i, _j, _k, _l, _len, _len1, _len2, _len3, _len4, _m, _n, _name, _ref, _ref1, _ref2, _ref3, _ref4, _results;
      if (!this.dynamic) {
        return;
      }
      r = window.devicePixelRatio;
      w = this.canvas.width;
      h = this.canvas.height;
      step = 0.001;
      this.ctx.clearRect(0, 0, w, h);
      this.ctx.strokeStyle = '#D5E6F8';
      this.ctx.lineWidth = 1;
      this.ctx.beginPath();
      this.ctx.moveTo(0, 0.67 * h);
      this.ctx.lineTo(w, 0.67 * h);
      this.ctx.stroke();
      this.ctx.beginPath();
      this.ctx.moveTo(0, 0.34 * h);
      this.ctx.lineTo(w, 0.34 * h);
      this.ctx.stroke();
      this.dynamic.init();
      graphes = [];
      colors = ['#007EFF'];
      defaultColor = '#D5E6F8';
      colorI = 0;
      while (args = this.dynamic.next(step)) {
        for (i = _i = 1, _ref = args.length; 1 <= _ref ? _i <= _ref : _i >= _ref; i = 1 <= _ref ? ++_i : --_i) {
          graphes[_name = i - 1] || (graphes[_name] = {
            points: []
          });
          graphes[i - 1].points.push([args[0], args[i]]);
        }
        if (args[0] >= 1) {
          break;
        }
      }
      for (_j = 0, _len = graphes.length; _j < _len; _j++) {
        graph = graphes[_j];
        color = defaultColor;
        if (colorI < colors.length) {
          color = colors[colorI];
        }
        graph.color = color;
        graph.index = colorI;
        colorI += 1;
      }
      _ref1 = graphes.reverse();
      for (_k = 0, _len1 = _ref1.length; _k < _len1; _k++) {
        graph = _ref1[_k];
        points = graph.points;
        this.ctx.beginPath();
        this.ctx.strokeStyle = graph.color;
        this._drawCurve(points);
        if (graph.index === 0) {
          this.ctx.lineWidth = 2 * r;
        } else {
          this.ctx.lineWidth = 1 * r;
        }
        this.ctx.stroke();
      }
      if (this.points) {
        _ref2 = this.points;
        for (_l = 0, _len2 = _ref2.length; _l < _len2; _l++) {
          point = _ref2[_l];
          _ref3 = point.controlPoints;
          for (_m = 0, _len3 = _ref3.length; _m < _len3; _m++) {
            controlPoint = _ref3[_m];
            this.ctx.beginPath();
            this.ctx.strokeStyle = colors[0];
            this.ctx.lineWidth = 1;
            coords = this.pointCoordinates(point);
            this.ctx.moveTo(coords.x, coords.y);
            coordsControlPoint = this.pointCoordinates(controlPoint);
            this.ctx.lineTo(coordsControlPoint.x, coordsControlPoint.y);
            this.ctx.stroke();
          }
        }
        _ref4 = this.points;
        _results = [];
        for (_n = 0, _len4 = _ref4.length; _n < _len4; _n++) {
          point = _ref4[_n];
          this.ctx.beginPath();
          this.ctx.strokeStyle = this.selectedPoint === point ? 'black' : colors[0];
          this.ctx.fillStyle = 'white';
          this.ctx.lineWidth = 2 * r;
          coords = this.pointCoordinates(point);
          this.ctx.arc(coords.x, coords.y, 5 * r, 0, Math.PI * 2, true);
          this.ctx.fill();
          this.ctx.stroke();
          _results.push((function() {
            var _len5, _o, _ref5, _results1;
            _ref5 = point.controlPoints;
            _results1 = [];
            for (_o = 0, _len5 = _ref5.length; _o < _len5; _o++) {
              controlPoint = _ref5[_o];
              this.ctx.beginPath();
              this.ctx.strokeStyle = this.selectedPoint === controlPoint ? 'black' : colors[0];
              this.ctx.fillStyle = 'white';
              this.ctx.lineWidth = 1 * r;
              coords = this.pointCoordinates(controlPoint);
              this.ctx.arc(coords.x, coords.y, 3 * r, 0, Math.PI * 2, true);
              this.ctx.fill();
              _results1.push(this.ctx.stroke());
            }
            return _results1;
          }).call(this));
        }
        return _results;
      }
    };

    UIGraph.prototype.locationFromEvent = function(e) {
      return {
        x: e.layerX,
        y: e.layerY
      };
    };

    UIGraph.prototype.isLocationAroundCenter = function(location, center, size) {
      var r;
      r = window.devicePixelRatio;
      center = {
        x: center.x / r,
        y: center.y / r
      };
      return (location.x >= center.x - size / 2) && (location.x <= center.x + size / 2) && (location.y >= center.y - size / 2) && (location.y <= center.y + size / 2);
    };

    UIGraph.prototype.pointFromLocation = function(location) {
      var controlPoint, point, _i, _j, _len, _len1, _ref, _ref1;
      if (!(this.points != null) || this.points.length < 2) {
        return null;
      }
      _ref = this.points;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        point = _ref[_i];
        if (point !== this.points[0]) {
          if (this.isLocationAroundCenter(location, this.pointCoordinates(point), 14)) {
            return point;
          }
        }
        _ref1 = point.controlPoints;
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          controlPoint = _ref1[_j];
          if (this.isLocationAroundCenter(location, this.pointCoordinates(controlPoint), 10)) {
            return controlPoint;
          }
        }
      }
      return null;
    };

    UIGraph.prototype.canvasMouseDown = function(e) {
      var converted, location, point;
      location = this.locationFromEvent(e);
      point = this.pointFromLocation(location);
      this.selectedPoint = point;
      if (!this.selectedPoint) {
        converted = this.convertFromCoordinates(location);
        this.selectedPoint = {
          x: converted.x,
          y: converted.y,
          controlPoints: [
            {
              x: converted.x - 0.1,
              y: converted.y
            }, {
              x: converted.x + 0.1,
              y: converted.y
            }
          ]
        };
        this.insertPoint(this.selectedPoint);
      }
      this.draw();
      return this.dragging = true;
    };

    UIGraph.prototype.canvasMouseMove = function(e) {
      var controlPoint, location, point, _i, _len, _ref;
      if (!this.selectedPoint) {
        return;
      }
      if (!this.dragging) {
        return;
      }
      location = this.locationFromEvent(e);
      point = this.convertFromCoordinates(location);
      if (this.selectedPoint === this.points[this.points.length - 1]) {
        point.x = 1;
        point.y = Math.min(1, Math.max(0, Math.round(point.y)));
      }
      if (this.selectedPoint.controlPoints) {
        _ref = this.selectedPoint.controlPoints;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          controlPoint = _ref[_i];
          controlPoint.x = roundf(controlPoint.x + point.x - this.selectedPoint.x, 3);
          controlPoint.y = roundf(controlPoint.y + point.y - this.selectedPoint.y, 3);
        }
      }
      this.selectedPoint.x = point.x;
      this.selectedPoint.y = point.y;
      return this.draw();
    };

    UIGraph.prototype.canvasMouseUp = function(e) {
      this.dragging = false;
      return typeof this.pointsChanged === "function" ? this.pointsChanged() : void 0;
    };

    UIGraph.prototype.canvasKeyUp = function(e) {
      if (!this.selectedPoint) {
        return;
      }
      if (e.keyCode === 8) {
        if (!this.selectedPoint.controlPoints) {
          return;
        }
        if (this.selectedPoint === this.points[0] || this.selectedPoint === this.points[this.points.length - 1]) {
          return;
        }
        e.preventDefault();
        e.stopPropagation();
        this.points.splice(this.points.indexOf(this.selectedPoint), 1);
        this.selectedPoint = null;
        return typeof this.pointsChanged === "function" ? this.pointsChanged() : void 0;
      }
    };

    UIGraph.prototype.pointCoordinates = function(point) {
      var h, w;
      w = this.canvas.width;
      h = this.canvas.height;
      return {
        x: point.x * w,
        y: (0.67 * h) - (point.y * 0.33 * h)
      };
    };

    UIGraph.prototype.convertFromCoordinates = function(location) {
      var h, r, w;
      r = window.devicePixelRatio;
      w = this.canvas.width;
      h = this.canvas.height;
      return {
        x: roundf(location.x / w * r, 3),
        y: roundf(((0.67 * h) - (location.y * r)) / (0.33 * h), 3)
      };
    };

    UIGraph.prototype.insertPoint = function(toInsertPoint) {
      var i, index, point, _ref;
      if (!this.points) {
        return;
      }
      index = 0;
      _ref = this.points;
      for (i in _ref) {
        point = _ref[i];
        if (point.x >= toInsertPoint.x) {
          index = i;
          break;
        }
      }
      return this.points.splice(index, 0, toInsertPoint);
    };

    UIGraph.prototype._drawCurve = function(points) {
      var h, point, r, t, v, w, _i, _len, _results;
      r = window.devicePixelRatio;
      w = this.canvas.width;
      h = this.canvas.height;
      _results = [];
      for (_i = 0, _len = points.length; _i < _len; _i++) {
        point = points[_i];
        t = point[0], v = point[1];
        if (t === 0) {
          _results.push(this.ctx.moveTo(t * w, h - ((0.33 + (v * 0.33)) * h)));
        } else {
          _results.push(this.ctx.lineTo(t * w, h - ((0.33 + (v * 0.33)) * h)));
        }
      }
      return _results;
    };

    return UIGraph;

  })();

  UIProperty = (function() {

    function UIProperty(options) {
      this.options = options != null ? options : {};
      this.setValue = __bind(this.setValue, this);

      this.el = document.createElement('div');
      this.label = document.createElement('label');
      this.label.innerHTML = this.options.property;
      this.valueEl = document.createElement('div');
      this.valueEl.classList.add('value');
      this.valueEl.classList.add(options.property);
      this.el.appendChild(this.label);
      this.el.appendChild(this.valueEl);
      this.valueEl.innerHTML = this.options.value;
    }

    UIProperty.prototype.setValue = function(value) {
      this.options.value = value;
      return this.valueEl.innerHTML = this.options.value;
    };

    return UIProperty;

  })();

  UISlider = (function() {

    function UISlider(options) {
      var _base, _base1;
      this.options = options != null ? options : {};
      this._windowMouseUp = __bind(this._windowMouseUp, this);

      this._windowMouseMove = __bind(this._windowMouseMove, this);

      this._controlMouseDown = __bind(this._controlMouseDown, this);

      this._updateLeftFromValue = __bind(this._updateLeftFromValue, this);

      this.value = __bind(this.value, this);

      (_base = this.options).min || (_base.min = 0);
      (_base1 = this.options).max || (_base1.max = 1000);
      if (this.options.value === void 0) {
        this.options.value = 10;
      }
      this.width = 205 - 11;
      this.el = document.createElement('div');
      this.label = document.createElement('label');
      this.label.innerHTML = this.options.property;
      this.valueEl = document.createElement('div');
      this.valueEl.classList.add('value');
      this.valueEl.classList.add(options.property);
      this.slider = document.createElement('div');
      this.slider.classList.add('slider');
      this.slider.classList.add(options.property);
      this.bar = document.createElement('div');
      this.bar.classList.add('bar');
      this.control = document.createElement('div');
      this.control.classList.add('control');
      this.slider.appendChild(this.bar);
      this.slider.appendChild(this.control);
      this.el.appendChild(this.label);
      this.el.appendChild(this.valueEl);
      this.el.appendChild(this.slider);
      this.valueEl.innerHTML = this.options.value;
      this._updateLeftFromValue();
      this.control.addEventListener('mousedown', this._controlMouseDown);
    }

    UISlider.prototype.value = function() {
      return this.options.value;
    };

    UISlider.prototype._updateLeftFromValue = function() {
      return this.control.style.left = (this.options.value - this.options.min) / (this.options.max - this.options.min) * this.width + "px";
    };

    UISlider.prototype._controlMouseDown = function(e) {
      this.dragging = true;
      this.startPoint = [e.pageX, e.pageY];
      this.startLeft = parseInt(this.control.style.left || 0);
      window.addEventListener('mousemove', this._windowMouseMove);
      return window.addEventListener('mouseup', this._windowMouseUp);
    };

    UISlider.prototype._windowMouseMove = function(e) {
      var dX, newLeft;
      if (!this.dragging) {
        return;
      }
      dX = e.pageX - this.startPoint[0];
      newLeft = this.startLeft + dX;
      if (newLeft > this.width) {
        newLeft = this.width;
      } else if (newLeft < 0) {
        newLeft = 0;
      }
      this.options.value = Math.round(newLeft / this.width * (this.options.max - this.options.min) + this.options.min);
      this.valueEl.innerHTML = this.options.value;
      if (typeof this.onUpdate === "function") {
        this.onUpdate();
      }
      return this.control.style.left = newLeft + "px";
    };

    UISlider.prototype._windowMouseUp = function(e) {
      this.dragging = false;
      window.removeEventListener('mousemove', this._windowMouseMove);
      return window.removeEventListener('mouseup', this._windowMouseUp);
    };

    return UISlider;

  })();

  UIPanel = (function() {

    function UIPanel(options) {
      this.options = options != null ? options : {};
      this.setSize = __bind(this.setSize, this);

      this.makeResizable = __bind(this.makeResizable, this);

      this.makeDraggable = __bind(this.makeDraggable, this);

      this.removeAnimation = __bind(this.removeAnimation, this);

      this.addAnimation = __bind(this.addAnimation, this);

      this.close = __bind(this.close, this);

      this.update = __bind(this.update, this);

      this.updateOptions = __bind(this.updateOptions, this);

      this.selectDidChange = __bind(this.selectDidChange, this);

      this.refreshFromAnimation = __bind(this.refreshFromAnimation, this);

      this.open = __bind(this.open, this);

      this.show = __bind(this.show, this);

      this.animations = [];
      this.currentAnimation = null;
      this.hidden = true;
      this.width = 438;
      this.height = 500;
      this.openingAnimation = true;
    }

    UIPanel.prototype.show = function(loaded) {
      var aDynamicsClass, closeButton, contentEl, graphEl, k, option, resizeButton, settingsEl, spanIndex0, spanIndex1, v, windowTitle, _i, _len, _ref, _ref1,
        _this = this;
      if (loaded == null) {
        loaded = false;
      }
      if (!this.hidden) {
        return;
      }
      if (!loaded) {
        return onReady(function() {
          return _this.show(true);
        });
      }
      this.hidden = false;
      if (this.el) {
        this.open();
        return;
      }
      this.el = document.createElement('div');
      this.el.id = 'DynamicsInteractivePanel';
      this.el.addEventListener('click', function(e) {
        return e.stopPropagation();
      });
      closeButton = document.createElement('div');
      closeButton.className = 'closeButton';
      closeButton.addEventListener('click', this.close);
      this.el.appendChild(closeButton);
      resizeButton = document.createElement('div');
      resizeButton.className = 'resizeButton';
      this.makeResizable(resizeButton);
      this.el.appendChild(resizeButton);
      windowTitle = document.createElement('div');
      windowTitle.className = 'title';
      windowTitle.innerHTML = "Dynamics.js - Curve creator";
      this.makeDraggable(windowTitle);
      this.el.appendChild(windowTitle);
      contentEl = document.createElement('div');
      contentEl.className = 'content';
      graphEl = document.createElement('div');
      graphEl.className = 'graph';
      this.canvas = document.createElement('canvas');
      this.canvas.setAttribute('tabIndex', '0');
      this.canvas.width = "350";
      this.canvas.height = "350";
      spanIndex0 = document.createElement('span');
      spanIndex0.className = 'index0';
      spanIndex0.innerHTML = '0';
      spanIndex1 = document.createElement('span');
      spanIndex1.className = 'index1';
      spanIndex1.innerHTML = '1';
      graphEl.appendChild(this.canvas);
      graphEl.appendChild(spanIndex0);
      graphEl.appendChild(spanIndex1);
      contentEl.appendChild(graphEl);
      settingsEl = document.createElement('div');
      settingsEl.className = 'settings';
      this.select = document.createElement('select');
      this.select.className = 'dynamics';
      this.optionsEl = document.createElement('div');
      this.optionsEl.className = 'options';
      settingsEl.appendChild(this.select);
      settingsEl.appendChild(this.optionsEl);
      contentEl.appendChild(settingsEl);
      this.el.appendChild(contentEl);
      this.dynamicsClasses = [];
      _ref = Dynamics.Types;
      for (k in _ref) {
        v = _ref[k];
        this.dynamicsClasses.push(v);
      }
      this.currentCircle = null;
      this.dynamicsClass = this.dynamicsClasses[0];
      _ref1 = this.dynamicsClasses;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        aDynamicsClass = _ref1[_i];
        if (aDynamicsClass.name === this.options.type) {
          this.dynamicsClass = aDynamicsClass;
        }
        option = document.createElement('option');
        option.innerHTML = "Dynamics.Types." + (getName(aDynamicsClass));
        option.value = getName(aDynamicsClass);
        this.select.appendChild(option);
      }
      this.select.addEventListener('change', this.selectDidChange);
      this.graph = new UIGraph(this.canvas);
      this.sliders = [];
      this.properties = [];
      this.setSize(this.width, this.height);
      if (this.openingAnimation) {
        this.el.style.opacity = 0;
        return this.open();
      } else {
        return document.body.appendChild(this.el);
      }
    };

    UIPanel.prototype.open = function() {
      this.el.style.transform = this.el.style.MozTransform = this.el.style.webkitTransform = 'scale(.7)';
      document.body.appendChild(this.el);
      return new Dynamics.Animation(this.el, {
        transform: 'scale(1)',
        opacity: 1
      }, {
        type: Dynamics.Types.Spring,
        frequency: 6,
        friction: 130,
        anticipationStrength: 0,
        anticipationSize: 0,
        duration: 500,
        animated: true
      }).start();
    };

    UIPanel.prototype.refreshFromAnimation = function() {
      if (this.hidden) {
        return;
      }
      this.select.value = getName(this.currentAnimation.options.type);
      return this.selectDidChange();
    };

    UIPanel.prototype.selectDidChange = function() {
      var name;
      name = this.select.options[this.select.selectedIndex].value;
      this.dynamicsClass = eval("Dynamics.Types." + name);
      this.updateOptions();
      return this.update();
    };

    UIPanel.prototype.updateOptions = function() {
      var config, property, slider, uiProperty, values, _i, _len, _ref, _ref1, _ref2, _results;
      this.optionsEl.innerHTML = '';
      values = this.currentAnimation.options;
      this.sliders = [];
      this.properties = [];
      this.points = null;
      if (this.dynamicsClass == null) {
        return;
      }
      _ref = this.dynamicsClass.properties;
      for (property in _ref) {
        config = _ref[property];
        if (config.type === 'points') {
          if (values.points) {
            try {
              this.points = JSON.parse(values.points);
            } catch (e) {
              this.points = config["default"];
            }
          } else {
            this.points = config["default"];
          }
        } else if (config.editable === false) {
          uiProperty = new UIProperty({
            value: 'N/A',
            property: property
          });
          this.optionsEl.appendChild(uiProperty.el);
          this.properties.push(uiProperty);
        } else {
          slider = new UISlider({
            min: config.min,
            max: config.max,
            value: (_ref1 = values[property]) != null ? _ref1 : config["default"],
            property: property
          });
          this.optionsEl.appendChild(slider.el);
          this.sliders.push(slider);
        }
      }
      _ref2 = this.sliders;
      _results = [];
      for (_i = 0, _len = _ref2.length; _i < _len; _i++) {
        slider = _ref2[_i];
        _results.push(slider.onUpdate = this.update);
      }
      return _results;
    };

    UIPanel.prototype.update = function() {
      var k, options, slider, uiProperty, _i, _j, _k, _len, _len1, _len2, _ref, _ref1, _ref2;
      if (!this.currentAnimation) {
        return;
      }
      options = {};
      _ref = this.sliders;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        slider = _ref[_i];
        options[slider.options.property] = slider.value();
      }
      if (this.dynamicsClass) {
        options['type'] = this.dynamicsClass;
      }
      if (this.points) {
        options['points'] = this.points;
      }
      _ref1 = ['complete', 'optionsChanged', 'debugName'];
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        k = _ref1[_j];
        options[k] = this.currentAnimation.options[k];
      }
      this.options = options;
      Overrides.setOverride(this.options, this.currentAnimation.options.debugName);
      this.currentAnimation.setOptions(this.options);
      this.graph.dynamic = this.currentAnimation.dynamic();
      this.graph.points = this.currentAnimation.dynamic().options.points;
      this.graph.pointsChanged = this.update;
      this.graph.draw();
      _ref2 = this.properties;
      for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {
        uiProperty = _ref2[_k];
        uiProperty.setValue(this.currentAnimation.dynamic()[uiProperty.options.property]());
      }
      return typeof this.onUpdate === "function" ? this.onUpdate() : void 0;
    };

    UIPanel.prototype.close = function() {
      var _this = this;
      this.hidden = true;
      return new Dynamics.Animation(this.el, {
        transform: 'scale(.1)',
        opacity: 0
      }, {
        type: Dynamics.Types.Spring,
        frequency: 6,
        friction: 130,
        anticipationStrength: 0,
        anticipationSize: 0,
        duration: 500,
        animated: true,
        complete: function() {
          return _this.el.parentNode.removeChild(_this.el);
        }
      }).start();
    };

    UIPanel.prototype.addAnimation = function(animation) {
      this.show();
      this.animations.push(animation);
      if (!(this.currentAnimation != null)) {
        this.currentAnimation = animation;
        return this.refreshFromAnimation();
      }
    };

    UIPanel.prototype.removeAnimation = function(animation) {
      var pos;
      pos = this.animations.indexOf(animation);
      if (pos === -1) {
        return;
      }
      this.animations.splice(pos, 1);
      if (animation === this.currentAnimation) {
        if (this.animations.length > 0) {
          this.currentAnimation = this.animations[0];
        } else {
          this.currentAnimation = null;
        }
        return this.refreshFromAnimation();
      }
    };

    UIPanel.prototype.makeDraggable = function(el) {
      var initialPos, initialTopLeft, _windowMouseMove, _windowMouseUp,
        _this = this;
      initialPos = null;
      initialTopLeft = null;
      _windowMouseMove = function(e) {
        var pos;
        pos = {
          x: e.pageX,
          y: e.pageY
        };
        _this.el.style.top = (Math.max(0, initialTopLeft.top + pos.y - initialPos.y)) + 'px';
        return _this.el.style.left = (initialTopLeft.left + pos.x - initialPos.x) + 'px';
      };
      _windowMouseUp = function(e) {
        window.removeEventListener('mousemove', _windowMouseMove);
        return window.removeEventListener('mouseup', _windowMouseUp);
      };
      return el.addEventListener('mousedown', function(e) {
        var style;
        initialPos = {
          x: e.pageX,
          y: e.pageY
        };
        style = window.getComputedStyle(_this.el);
        initialTopLeft = {
          top: parseInt(style.top, 10),
          left: parseInt(style.left, 10)
        };
        window.addEventListener('mousemove', _windowMouseMove);
        return window.addEventListener('mouseup', _windowMouseUp);
      });
    };

    UIPanel.prototype.makeResizable = function(el) {
      var initialPos, initialSize, _windowMouseMove, _windowMouseUp,
        _this = this;
      initialPos = null;
      initialSize = null;
      _windowMouseMove = function(e) {
        var pos;
        pos = {
          x: e.pageX,
          y: e.pageY
        };
        return _this.setSize(initialSize.width + pos.x - initialPos.x, initialSize.height + pos.y - initialPos.y);
      };
      _windowMouseUp = function(e) {
        window.removeEventListener('mousemove', _windowMouseMove);
        return window.removeEventListener('mouseup', _windowMouseUp);
      };
      return el.addEventListener('mousedown', function(e) {
        var style;
        initialPos = {
          x: e.pageX,
          y: e.pageY
        };
        style = window.getComputedStyle(_this.el);
        initialSize = {
          width: parseInt(style.width, 10),
          height: parseInt(style.height, 10)
        };
        window.addEventListener('mousemove', _windowMouseMove);
        return window.addEventListener('mouseup', _windowMouseUp);
      });
    };

    UIPanel.prototype.setSize = function(width, height) {
      var canvasSize, r;
      if (width > 584) {
        width = 584;
      }
      if (width < 438) {
        width = 438;
      }
      height = (width - 234) + 28;
      this.width = width;
      this.height = height;
      if (!this.el) {
        return;
      }
      this.el.style.width = width + 'px';
      this.el.style.height = height + 'px';
      r = window.devicePixelRatio || 1;
      canvasSize = (width - 234) * r;
      this.canvas.width = "" + canvasSize;
      this.canvas.height = "" + canvasSize;
      return this.graph.draw();
    };

    return UIPanel;

  })();

  Overrides = {
    overrides: {},
    "for": function(name) {
      return true;
    },
    getOverride: function(options, name) {
      var k, newOptions, v, _ref;
      if (!Overrides.overrides[name]) {
        return options;
      }
      newOptions = {};
      for (k in options) {
        v = options[k];
        newOptions[k] = v;
      }
      _ref = Overrides.overrides[name];
      for (k in _ref) {
        v = _ref[k];
        if (k !== 'complete') {
          newOptions[k] = v;
        }
      }
      return newOptions;
    },
    setOverride: function(options, name) {
      var k, newOptions, v;
      newOptions = {};
      for (k in options) {
        v = options[k];
        newOptions[k] = v;
      }
      return Overrides.overrides[name] = newOptions;
    }
  };

  if (!(window.Dynamics != null)) {
    window.Dynamics = {};
  }

  window.Dynamics.InteractivePanel = new UIPanel;

  window.Dynamics.Overrides = Overrides;

  onReady(function() {
    var style;
    style = document.createElement('style');
    style.innerHTML = css;
    return document.head.appendChild(style);
  });

}).call(this);
